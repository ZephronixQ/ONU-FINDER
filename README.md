# ONU Finder / ONU Diagnostics

**ONU Finder** — диагностический скрипт для поиска и анализа состояния ONU по серийному номеру.
Скрипт асинхронно подключается к нескольким GPON-коммутаторам по Telnet, находит ONU и выводит **полный набор диагностических данных** в виде таблиц и предупреждений.

---

## Возможности

Скрипт выполняет **комплексную проверку ONU**:

### 🔍 Поиск

* Поиск ONU по **серийному номеру**
* Асинхронное подключение ко всем коммутаторам
* Остановка поиска при первом найденном совпадении

### 📋 Основная информация

* IP коммутатора
* GPON-порт ONU
* ID договора (Remote-ID)

### 🌐 IP STATUS

* IP-адрес ONU
* MAC-адрес
* VLAN
* Предупреждения:

  * отсутствует IP или MAC
  * обнаружено несколько MAC-адресов (LAN/WAN mix-up)

### 📡 PON POWER LEVELS

* RX / TX уровни OLT ↔ ONU
* Затухание линии
* Предупреждение при слабом downstream-сигнале
  (`|Rx| > 27 dBm`, настраивается)

### ⚡ OPERATE / SPEED / THROUGHPUT

* Статус ONU (enable / disable)
* Статус Ethernet-порта
* Входящий и исходящий трафик (Mbit/s)
* Предупреждения:

  * ONU включена, но MAC уже есть (возможен сброс роутера)
  * ONU отключена
  * скорость порта не `Full-1000`

### 📝 ONU DETAIL LOGS

* История регистраций ONU
* Authpass Time
* Offline Time
* Cause

🚨 **Автоматическое предупреждение о вызове мастера**:

* Если **последняя непустая запись `Cause` = `LOS` или `LOSi`**
* После неё **нет других событий**
* Выводится предупреждение:

```
LOS/LOSi detected in last cause entry — possible fiber issue, send technician
```

---

## Установка

Требования:

* Python **3.10+**

Установка зависимости:

```bash
pip install telnetlib3
```

Скрипт не использует сторонние библиотеки, кроме `telnetlib3` и стандартной библиотеки Python.

---

## Настройки

В начале файла необходимо указать параметры подключения:

```python
SWITCHES = [
    "192.168.2.12",
    "192.168.2.13",
    "192.168.2.14",
    "192.168.2.16",
    "192.168.2.17",
    "192.168.2.18",
    "192.168.2.19",
]

USERNAME = "admin"
PASSWORD = "admin"
TELNET_PORT = 23

DOWN_RX_WARN_THRESHOLD = 27.0  # |Rx| > 27 dBm → слабый сигнал
```

---

## Использование

Запуск из терминала:

```bash
python3 onu_finder.py <ONU_SERIAL>
```

Пример:

```bash
python3 onu_finder.py 48575443ABCD
```

---

## Пример вывода (сокращённо)

```
✅ ONU FOUND
┌───────────────┬───────────────┬─────────┬─────────┐
│  SWITCH IP    │    SERIAL     │  PORT   │   ID    │
├───────────────┼───────────────┼─────────┼─────────┤
│ 192.168.2.12  │ 48575443ABCD  │ 1/1/1:1 │ 123456  │
└───────────────┴───────────────┴─────────┴─────────┘

🌐 IP STATUS
...

📡 PON POWER LEVELS
...

⚡ OPERATE / SPEED / THROUGHPUT
...

📝 ONU DETAIL LOGS
...

LOS/LOSi detected in last cause entry — possible fiber issue, send technician
```

---

## Цветовая индикация

* 🟢 **Зелёный**
* 🟡 **Жёлтый**
* 🔴 **Красный**
* 🟣 **Магента**
* 🔵 **Синий**

---

## Особенности реализации

* Асинхронный поиск по всем коммутаторам
* Корректная очистка ANSI-кодов
* Динамические таблицы в терминале
* Строгая логика определения аварии по `LOS / LOSi`
* Подходит для NOC / L1–L2 диагностики
